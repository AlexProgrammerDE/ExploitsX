package me.bait.exploitsx;

import java.io.File;
import java.io.IOException;
import java.util.HashMap;
import java.util.UUID;

import org.bukkit.Bukkit;
import org.bukkit.ChatColor;
import org.bukkit.command.Command;
import org.bukkit.command.CommandSender;
import org.bukkit.configuration.file.FileConfiguration;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerCommandPreprocessEvent;
import org.bukkit.plugin.PluginManager;
import org.bukkit.plugin.java.JavaPlugin;

import me.bait.exploitsx.util.CH;
import me.bait.exploitsx.abuseprotect.OpPrevent;
import me.bait.exploitsx.chatco.AllChat;
import me.bait.exploitsx.chatco.ChatCommandHandle;
import me.bait.exploitsx.chatco.JSONMessage;
import me.bait.exploitsx.chatco.Spoilers;
import me.bait.exploitsx.chatco.Whispers;
import me.bait.exploitsx.exploits.ChunkBan;
import me.bait.exploitsx.exploits.Interaction;
import me.bait.exploitsx.exploits.LightingLag;
import me.bait.exploitsx.exploits.MapFill;
import me.bait.exploitsx.exploits.Offhand;
import me.bait.exploitsx.exploits.OnTeleport;
import me.bait.exploitsx.exploits.PortalBreaker;
import me.bait.exploitsx.gameplay.AntiRedstone;
import me.bait.exploitsx.gameplay.Entity;
import me.bait.exploitsx.gameplay.ItemSpawn;
import me.bait.exploitsx.gameplay.Join;
import me.bait.exploitsx.gameplay.JoinLeave;
import me.bait.exploitsx.gameplay.Placeholder;
import me.bait.exploitsx.gameplay.RegisterStats;
import me.bait.exploitsx.gameplay.LagPatches;
import me.bait.exploitsx.util.API;
import me.bait.exploitsx.util.CommandHandle;
import me.bait.exploitsx.util.TPS;
import me.bait.exploitsx.util.Update;

//-- // WARNING \\ -- 
//-- THIS WORK IS UNDER EXCLUSIVE COPRIGHT FOR BAITCORP LABS. DISTRIBUTION, MODIFICATION, SELLING, OR SHARING WITHOUT EXPLICIT PERMISSION FROM BAITCORP LABS IS STRICTLY PROHIBITED.
//-- THIS PROGRAM IS LICENSED FOR MODIFICATION TO AND ONLY TO: "BAITCORP LABS" [FR], "CCHOST PARIS" [FR].
//-- 
//-- DECOMPILING, COPYING OR REDISTRIBUTING THIS CODE IS A CRIME. IF YOU HAVE ANY QUESTIONS OR CONCERNS
//-- THEY MUST BE VOICED DIRECTLY TO BAITCORP EXECUTIVES BEFORE PERSONAL ACTION.
//-- 
//-- ExploitsX Sebastian Giheta 2019-2020
//-- //         \\ -- 

public class ExploitsX extends JavaPlugin implements Listener {

    /*
     * Suck my cock and balls, Sev, Mason, Leee and all you other fucking clowns. <3
     * Your code is shit and you like to break copyright laws. Mad at me for using
     * code like API.clearMemFiles() function that you fucking gave to me through
     * DMs? Okay, I'll change it all. Never liked it anyways. You guys think doxxing
     * teenagers and ruining their fucking lives because they rightfully took what
     * they owned away from you (6b6t.org) is appropriate? I make plugins to make
     * the community better. Not to ruin people's servers, to make them better.
     * Fuck all outta here.
     */

    public static File dataFolder;

    public static ExploitsX getPlugin() {
        return getPlugin(ExploitsX.class);
    }

    // private final Spoilers spoilerListener = new Spoilers(this);

    // private final Whispers whisperListener = new Whispers(this);

    HashMap<UUID, Integer> duping = new HashMap<>();

    FileConfiguration config = this.getConfig();

    @Override
    public boolean onCommand(CommandSender sender, Command cmd, String commandLabel, String[] args) {
        if (getConfig().getBoolean(Messages.getString("exf.0"))) { //$NON-NLS-1$
            String l = (Messages.getString("exf.1") + sender.getName() + Messages.getString("exf.2") + commandLabel //$NON-NLS-1$ //$NON-NLS-2$
                    + Messages.getString("exf.3")); //$NON-NLS-1$
            ExploitsX.getPlugin().getServer().getLogger().info(l);
        }
        if (!sender.isOp() && CH.getBoolean(Messages.getString("exf.4")) //$NON-NLS-1$
                && CH.getInt(Messages.getString("exf.5")) == JSONMessage.a07568e7c89fa4c9381c7a6ded56a355) { //$NON-NLS-1$
            char ap = '"';
            sender.sendMessage(ChatColor.WHITE + Messages.getString("exf.6") + ap + Messages.getString("exf.7") + ap //$NON-NLS-1$ //$NON-NLS-2$
                    + Messages.getString("exf.8")); //$NON-NLS-1$
            return true;
        }
        if (cmd.getName().equalsIgnoreCase(Messages.getString("exf.9")) //$NON-NLS-1$
                || cmd.getName().equalsIgnoreCase(Messages.getString("exf.10"))) { //$NON-NLS-1$
            if (args.length == 0) {
                if (CH.getBoolean(Messages.getString("exf.11"), true)) { //$NON-NLS-1$
                    sender.sendMessage(
                            ChatColor.GREEN + Messages.getString("exf.12") + API.getPrefix() + ChatColor.GREEN //$NON-NLS-1$
                                    + Messages.getString("exf.13")); //$NON-NLS-1$
                }
                sender.sendMessage(ChatColor.GREEN + Messages.getString("exf.14")); //$NON-NLS-1$
                return true;
            }
            if (args[0].equalsIgnoreCase("addvls") && sender.isOp()) { //$NON-NLS-1$
                if (args[1] == null || args[2] == null || Bukkit.getPlayer(args[1]) == null) {
                    sender.sendMessage(ChatColor.DARK_RED + "Usage: /e addvls PLAYERNAME amount.");
                } else {
                    AllChat.vlchat.put(Bukkit.getPlayer(args[1]), Double.parseDouble(args[2]));
                    sender.sendMessage(ChatColor.DARK_RED + "Done. " + args[2] + "vls has been added to player " + args[1] + ". They now have " + AllChat.vlchat.get(Bukkit.getPlayer(args[1])) + "vls.");
                }

                return true;
            }
            if (args.length == 1 && args[0].equalsIgnoreCase(Messages.getString("exf.15"))) { //$NON-NLS-1$
                if (sender.isOp()) {
                    this.reloadConfig();
                    Interaction.reload();
                    Update.checkUpdates();
                    Offhand.reload();
                    AllChat.reload();
                    MapFill.reload();
                    OnTeleport.reload();
                    LightingLag.reload();
                    Whispers.reload();
                    ChatCommandHandle.reload();
                    API.alertMessage(Messages.getString("exf.16")); //$NON-NLS-1$
                } else {
                    sender.sendMessage(ChatColor.YELLOW + Messages.getString("exf.17") + ChatColor.GRAY //$NON-NLS-1$
                            + Messages.getString("exf.18") + ChatColor.RED //$NON-NLS-1$
                            + Messages.getString("exf.19")); //$NON-NLS-1$
                }

                return true;
            }
            if (args.length == 1 && args[0].equalsIgnoreCase(Messages.getString("exf.20"))) { //$NON-NLS-1$
                if (CH.getBoolean(Messages.getString("exf.21"), true)) { //$NON-NLS-1$
                    sender.sendMessage(
                            ChatColor.RED + Messages.getString("exf.22") + ChatColor.AQUA + Messages.getString("exf.23") //$NON-NLS-1$ //$NON-NLS-2$
                                    + this.getDescription().getVersion());
                    sender.sendMessage(ChatColor.YELLOW + Messages.getString("exf.24")); //$NON-NLS-1$
                }
                sender.sendMessage(ChatColor.YELLOW + Messages.getString("exf.25") + ChatColor.GRAY //$NON-NLS-1$
                        + Messages.getString("exf.26") + ChatColor.AQUA //$NON-NLS-1$
                        + Messages.getString("exf.27") + ChatColor.GOLD + Bukkit.getServer().getBukkitVersion() //$NON-NLS-1$
                        + ChatColor.AQUA + Messages.getString("exf.28") + ChatColor.GOLD //$NON-NLS-1$
                        + Bukkit.getServer().getBukkitVersion().split(Messages.getString("exf.29"))[0] //$NON-NLS-1$
                        + ChatColor.AQUA + Messages.getString("exf.30") + ChatColor.GOLD + Messages.getString("exf.31") //$NON-NLS-1$ //$NON-NLS-2$
                        + ChatColor.AQUA + Messages.getString("exf.32")); //$NON-NLS-1$
                sender.sendMessage(ChatColor.YELLOW + Messages.getString("exf.33") + ChatColor.GRAY //$NON-NLS-1$
                        + Messages.getString("exf.34") + ChatColor.AQUA //$NON-NLS-1$
                        + Messages.getString("exf.35") + ChatColor.GOLD + API.timeSeconds + Messages.getString("exf.36") //$NON-NLS-1$ //$NON-NLS-2$
                        + ChatColor.AQUA + Messages.getString("exf.37") + ChatColor.GOLD //$NON-NLS-1$
                        + API.GetFormattedInterval(API.timeSeconds) + ChatColor.AQUA + Messages.getString("exf.38")); //$NON-NLS-1$
                sender.sendMessage(ChatColor.YELLOW + Messages.getString("exf.39") + ChatColor.GRAY //$NON-NLS-1$
                        + Messages.getString("exf.40") + ChatColor.AQUA //$NON-NLS-1$
                        + Messages.getString("exf.41") + ChatColor.GOLD + Bukkit.getMaxPlayers() + ChatColor.AQUA //$NON-NLS-1$
                        + Messages.getString("exf.42")); //$NON-NLS-1$
                sender.sendMessage(ChatColor.YELLOW + Messages.getString("exf.43") + ChatColor.GRAY //$NON-NLS-1$
                        + Messages.getString("exf.44") + ChatColor.AQUA //$NON-NLS-1$
                        + Messages.getString("exf.45") + ChatColor.GOLD + Bukkit.getOnlinePlayers().size() //$NON-NLS-1$
                        + ChatColor.AQUA + Messages.getString("exf.46")); //$NON-NLS-1$
                sender.sendMessage(ChatColor.YELLOW + Messages.getString("exf.47") + ChatColor.GRAY //$NON-NLS-1$
                        + Messages.getString("exf.48") + ChatColor.AQUA //$NON-NLS-1$
                        + Messages.getString("exf.49") + ChatColor.GOLD + Bukkit.getOfflinePlayers().length //$NON-NLS-1$
                        + ChatColor.AQUA + Messages.getString("exf.50")); //$NON-NLS-1$
                sender.sendMessage(ChatColor.YELLOW + Messages.getString("exf.51") + ChatColor.GRAY //$NON-NLS-1$
                        + Messages.getString("exf.52") + ChatColor.AQUA //$NON-NLS-1$
                        + Messages.getString("exf.53") + ChatColor.GOLD + API.getMemUsed() + ChatColor.AQUA //$NON-NLS-1$
                        + Messages.getString("exf.54") //$NON-NLS-1$
                        + ChatColor.GOLD + API.getMemTotal() + ChatColor.AQUA + Messages.getString("exf.55")); //$NON-NLS-1$
                sender.sendMessage(ChatColor.YELLOW + Messages.getString("exf.56") + ChatColor.GRAY //$NON-NLS-1$
                        + Messages.getString("exf.57") + ChatColor.AQUA //$NON-NLS-1$
                        + Messages.getString("exf.58") + ChatColor.GOLD + API.getVersionInt() //$NON-NLS-1$
                        + ChatColor.AQUA + Messages.getString("exf.59")); //$NON-NLS-1$
                sender.sendMessage(ChatColor.YELLOW + Messages.getString("exf.60") + ChatColor.GRAY //$NON-NLS-1$
                        + Messages.getString("exf.61") + ChatColor.AQUA //$NON-NLS-1$
                        + Messages.getString("exf.62") + API.format(API.getTps()) + ChatColor.AQUA //$NON-NLS-1$
                        + Messages.getString("exf.63")); //$NON-NLS-1$
                return true;
            }
            if (args.length == 1 && args[0].equalsIgnoreCase(Messages.getString("exf.64"))) { //$NON-NLS-1$
                sender.sendMessage(Messages.getString("exf.65") + API.format(API.getTps())); //$NON-NLS-1$
                return true;
            }
            if (args.length == 1 && args[0].equalsIgnoreCase(Messages.getString("exf.66"))) { //$NON-NLS-1$
                if (CH.getBoolean(Messages.getString("exf.67"), true)) { //$NON-NLS-1$
                    sender.sendMessage(
                            ChatColor.RED + Messages.getString("exf.68") + ChatColor.AQUA + Messages.getString("exf.69") //$NON-NLS-1$ //$NON-NLS-2$
                                    + this.getDescription().getVersion());
                } else {
                    sender.sendMessage(ChatColor.RED + Messages.getString("exf.70")); //$NON-NLS-1$
                }
                if (sender.isOp()) {
                    sender.sendMessage(ChatColor.YELLOW + Messages.getString("exf.71") + ChatColor.GRAY //$NON-NLS-1$
                            + Messages.getString("exf.72") + ChatColor.AQUA //$NON-NLS-1$
                            + Messages.getString("exf.73")); //$NON-NLS-1$
                    sender.sendMessage(ChatColor.YELLOW + Messages.getString("exf.74") //$NON-NLS-1$
                            + ChatColor.GRAY + Messages.getString("exf.75") + ChatColor.AQUA //$NON-NLS-1$
                            + Messages.getString("exf.76")); //$NON-NLS-1$
                    sender.sendMessage(ChatColor.YELLOW + Messages.getString("exf.77") + ChatColor.GRAY //$NON-NLS-1$
                            + Messages.getString("exf.78") //$NON-NLS-1$
                            + ChatColor.AQUA + Messages.getString("exf.79")); //$NON-NLS-1$
                }
                sender.sendMessage(ChatColor.YELLOW + Messages.getString("exf.80") + ChatColor.GRAY //$NON-NLS-1$
                        + Messages.getString("exf.81") + ChatColor.AQUA //$NON-NLS-1$
                        + Messages.getString("exf.82")); //$NON-NLS-1$
                sender.sendMessage(ChatColor.YELLOW + Messages.getString("exf.89") + "addvls " + ChatColor.GRAY //$NON-NLS-1$
                        + Messages.getString("exf.90") + ChatColor.AQUA
                        + "Add chat violations to a user. Usage: /e addvls PLAYER AMOUNT");
                sender.sendMessage(ChatColor.YELLOW + Messages.getString("exf.83") + ChatColor.GRAY //$NON-NLS-1$
                        + Messages.getString("exf.84") + ChatColor.AQUA + Messages.getString("exf.85")); //$NON-NLS-1$ //$NON-NLS-2$
                sender.sendMessage(ChatColor.YELLOW + Messages.getString("exf.86") + ChatColor.GRAY //$NON-NLS-1$
                        + Messages.getString("exf.87") + ChatColor.AQUA + Messages.getString("exf.88")); //$NON-NLS-1$ //$NON-NLS-2$
                sender.sendMessage(ChatColor.YELLOW + Messages.getString("exf.89") + ChatColor.GRAY //$NON-NLS-1$
                        + Messages.getString("exf.90") + ChatColor.AQUA + Messages.getString("exf.91")); //$NON-NLS-1$ //$NON-NLS-2$

                if (CH.getBoolean(Messages.getString("exf.92"), true)) { //$NON-NLS-1$
                    sender.sendMessage(ChatColor.RED + Messages.getString("exf.93")); //$NON-NLS-1$
                }
                return true;
            }
            return false;
        } else {
            if (getConfig().getBoolean(Messages.getString("exf.94"))) { //$NON-NLS-1$
                if (cmd.getName().equalsIgnoreCase(Messages.getString("exf.95"))) { //$NON-NLS-1$
                    if (getConfig().getBoolean(Messages.getString("exf.96"))) { //$NON-NLS-1$
                        sender.sendMessage(ChatColor.RED + Messages.getString("exf.97")); //$NON-NLS-1$
                        sender.sendMessage(ChatColor.WHITE + Messages.getString("exf.98") + ChatColor.GREEN //$NON-NLS-1$
                                + Messages.getString("exf.99") //$NON-NLS-1$
                                + ChatColor.WHITE + Messages.getString("exf.100") + ChatColor.GREEN //$NON-NLS-1$
                                + Messages.getString("exf.101") + ChatColor.WHITE + Messages.getString("exf.102") //$NON-NLS-1$ //$NON-NLS-2$
                                + ChatColor.GREEN + Messages.getString("exf.103") + ChatColor.WHITE //$NON-NLS-1$
                                + Messages.getString("exf.104") + ChatColor.GREEN //$NON-NLS-1$
                                + Messages.getString("exf.105") + ChatColor.WHITE + Messages.getString("exf.106") //$NON-NLS-1$ //$NON-NLS-2$
                                + ChatColor.GREEN + Messages.getString("exf.107") //$NON-NLS-1$
                                + ChatColor.WHITE + Messages.getString("exf.108") + ChatColor.GREEN //$NON-NLS-1$
                                + Messages.getString("exf.109") + ChatColor.WHITE + Messages.getString("exf.110") //$NON-NLS-1$ //$NON-NLS-2$
                                + ChatColor.GREEN + Messages.getString("exf.111") + ChatColor.WHITE //$NON-NLS-1$
                                + Messages.getString("exf.112") + ChatColor.GREEN //$NON-NLS-1$
                                + Messages.getString("exf.113") + ChatColor.WHITE + Messages.getString("exf.114") //$NON-NLS-1$ //$NON-NLS-2$
                                + ChatColor.GREEN + Messages.getString("exf.115") //$NON-NLS-1$
                                + ChatColor.WHITE + Messages.getString("exf.116") + ChatColor.GREEN //$NON-NLS-1$
                                + Messages.getString("exf.117") + ChatColor.WHITE + Messages.getString("exf.118") //$NON-NLS-1$ //$NON-NLS-2$
                                + ChatColor.GREEN + Messages.getString("exf.119") + ChatColor.WHITE //$NON-NLS-1$
                                + Messages.getString("exf.120") + ChatColor.GREEN //$NON-NLS-1$
                                + Messages.getString("exf.121") + ChatColor.WHITE + Messages.getString("exf.122") //$NON-NLS-1$ //$NON-NLS-2$
                                + ChatColor.GREEN + Messages.getString("exf.123") //$NON-NLS-1$
                                + ChatColor.WHITE + Messages.getString("exf.124") + ChatColor.GREEN //$NON-NLS-1$
                                + Messages.getString("exf.125") + ChatColor.WHITE + Messages.getString("exf.126") //$NON-NLS-1$ //$NON-NLS-2$
                                + ChatColor.GREEN + Messages.getString("exf.127") + ChatColor.WHITE //$NON-NLS-1$
                                + Messages.getString("exf.128") + ChatColor.GREEN + Messages.getString("exf.129") //$NON-NLS-1$ //$NON-NLS-2$
                                + ChatColor.WHITE + Messages.getString("exf.130") + ChatColor.GREEN //$NON-NLS-1$
                                + Messages.getString("exf.131") + ChatColor.WHITE //$NON-NLS-1$
                                + Messages.getString("exf.132") + ChatColor.GREEN + Messages.getString("exf.133") //$NON-NLS-1$ //$NON-NLS-2$
                                + ChatColor.WHITE + Messages.getString("exf.134") + ChatColor.GREEN //$NON-NLS-1$
                                + Messages.getString("exf.135") + ChatColor.WHITE + Messages.getString("exf.136") //$NON-NLS-1$ //$NON-NLS-2$
                                + ChatColor.GREEN + Messages.getString("exf.137") //$NON-NLS-1$
                                + ChatColor.WHITE + Messages.getString("exf.138") + ChatColor.GREEN //$NON-NLS-1$
                                + Messages.getString("exf.139") + ChatColor.WHITE + Messages.getString("exf.140") //$NON-NLS-1$ //$NON-NLS-2$
                                + ChatColor.GREEN + Messages.getString("exf.141")); //$NON-NLS-1$
                        sender.sendMessage(ChatColor.RED + Messages.getString("exf.142")); //$NON-NLS-1$
                    } else {
                        if (!getConfig().getString(Messages.getString("exf.143")).equals(Messages.getString("exf.144")) //$NON-NLS-1$ //$NON-NLS-2$
                                || !getConfig().getString(Messages.getString("exf.145")) //$NON-NLS-1$
                                .equals(Messages.getString("exf.146"))) { //$NON-NLS-1$
                            sender.sendMessage(ChatColor.translateAlternateColorCodes('&',
                                    getConfig().getString(Messages.getString("exf.147")))); //$NON-NLS-1$
                        }
                        sender.sendMessage(ChatColor.translateAlternateColorCodes('&',
                                getConfig().getString(Messages.getString("exf.148")))); //$NON-NLS-1$
                        if (!getConfig().getString(Messages.getString("exf.149")).equals(Messages.getString("exf.150")) //$NON-NLS-1$ //$NON-NLS-2$
                                || !getConfig().getString(Messages.getString("exf.151")) //$NON-NLS-1$
                                .equals(Messages.getString("exf.152"))) { //$NON-NLS-1$
                            sender.sendMessage(ChatColor.translateAlternateColorCodes('&',
                                    getConfig().getString(Messages.getString("exf.153")))); //$NON-NLS-1$
                        }
                    }
                    return true;
                }
            }
        }
        return false;
    }

    @Override
    public void onDisable() {
        RegisterStats.onDisable();
        if (CH.getBoolean(Messages.getString("exf.154"), true)) { //$NON-NLS-1$
            API.clearMemFiles(CH.getString(Messages.getString("exf.155"), Messages.getString("exf.156"))); //$NON-NLS-1$ //$NON-NLS-2$
        }
        getServer().getLogger().info(Messages.getString("exf.157")); //$NON-NLS-1$
    }

    @Override
    public void onEnable() {
        getServer().getLogger().info(Messages.getString("exf.158")); //$NON-NLS-1$
        getServer().getLogger().info(Messages.getString("exf.159")); //$NON-NLS-1$
        File dir = new File(Messages.getString("exf.160")); //$NON-NLS-1$
        if (!dir.exists())
            dir.mkdirs();
        dataFolder = getDataFolder();
        getServer().getLogger().info(Messages.getString("exf.161")); //$NON-NLS-1$
        this.saveDefaultConfig();
        try {
            CH.enable();
        } catch (IOException e) {
            e.printStackTrace();
        }
        int loglvl = CH.getInt(Messages.getString("exf.162"), 2); //$NON-NLS-1$
        if (loglvl > 1)
            getServer().getLogger().info(Messages.getString("exf.163")); //$NON-NLS-1$
        if (Bukkit.getPluginManager().getPlugin(Messages.getString("exf.164")) != null) { //$NON-NLS-1$
            Bukkit.getPluginManager().registerEvents(this, this);
            new Placeholder().register();
        } else {
            getLogger().warning(Messages.getString("exf.165")); //$NON-NLS-1$
        }
        if (loglvl > 0)
            getServer().getLogger().info(Messages.getString("exf.166")); //$NON-NLS-1$
        if (loglvl > 1)
            getServer().getLogger().info(Messages.getString("exf.167")); //$NON-NLS-1$
        if (loglvl > 1)
            getServer().getLogger().info(Messages.getString("exf.168")); //$NON-NLS-1$
        getServer().getMessenger().registerOutgoingPluginChannel(this, Messages.getString("exf.169")); //$NON-NLS-1$
        if (loglvl > 0)
            getServer().getLogger().info(Messages.getString("exf.170")); //$NON-NLS-1$
        PluginManager pm = getServer().getPluginManager();
        pm.registerEvents(new AntiRedstone(), this);
        pm.registerEvents(new ChunkBan(), this);
        pm.registerEvents(new Offhand(), this);
        pm.registerEvents(new LightingLag(), this);
        pm.registerEvents(new PortalBreaker(), this);
        pm.registerEvents(new LagPatches(), this);
        pm.registerEvents(new Join(), this);
        pm.registerEvents(new Entity(), this);
        pm.registerEvents(new CommandHandle(), this);
        pm.registerEvents(new OnTeleport(), this);
        pm.registerEvents(new MapFill(), this);
        pm.registerEvents(new ChatCommandHandle(), this);
        pm.registerEvents(new ItemSpawn(), this);
        pm.registerEvents(new JoinLeave(), this);
        pm.registerEvents(new OpPrevent(), this);
        pm.registerEvents(new Interaction(), this);
        if (loglvl > 1)
            getServer().getLogger().info(Messages.getString("exf.171")); //$NON-NLS-1$
        Interaction.begin();
        LightingLag.begin();
        if (loglvl > 1)
            getServer().getLogger().info(Messages.getString("exf.172")); //$NON-NLS-1$
        Bukkit.getServer().getScheduler().scheduleSyncRepeatingTask(this, new TPS(), 100L, 1L);
        if (loglvl > 0)
            getServer().getLogger().info(Messages.getString("exf.173")); //$NON-NLS-1$
        ChatCommandHandle.enable();
        if (loglvl > 1)
            getServer().getLogger().info(Messages.getString("exf.174")); //$NON-NLS-1$
        if (loglvl > 0)
            getServer().getLogger().info(Messages.getString("exf.175")); //$NON-NLS-1$
        Update.checkUpdates();
        getServer().getLogger().info(Messages.getString("exf.176")); //$NON-NLS-1$
        this.getCommand(Messages.getString("exf.177")).setExecutor(this); //$NON-NLS-1$
        this.getCommand(Messages.getString("exf.178")).setExecutor(this); //$NON-NLS-1$
        this.getCommand(Messages.getString("exf.179")).setExecutor(new CommandHandle()); //$NON-NLS-1$
        this.getCommand(Messages.getString("exf.180")).setExecutor(new CommandHandle()); //$NON-NLS-1$
        if (getConfig().getBoolean(Messages.getString("exf.181"))) { //$NON-NLS-1$
            getServer().getLogger().info(Messages.getString("exf.182")); //$NON-NLS-1$
            getServer().getPluginManager().registerEvents(new RegisterStats(), this);
            if (getConfig().getBoolean(Messages.getString("exf.183"))) { //$NON-NLS-1$
                this.getCommand(Messages.getString("exf.184")).setExecutor(new RegisterStats()); //$NON-NLS-1$
                this.getCommand(Messages.getString("exf.185")).setExecutor(new RegisterStats()); //$NON-NLS-1$
                this.getCommand(Messages.getString("exf.186")).setExecutor(new RegisterStats()); //$NON-NLS-1$
            }
        }
        if (loglvl > 1)
            getServer().getLogger().info(Messages.getString("exf.187")); //$NON-NLS-1$
        if (getConfig().getBoolean(Messages.getString("exf.188"))) { //$NON-NLS-1$
            this.getCommand(Messages.getString("exf.189")).setExecutor(this); //$NON-NLS-1$
        }
        if (loglvl > 0)
            getServer().getLogger().info(Messages.getString("exf.190")); //$NON-NLS-1$
        if (getConfig().getBoolean(Messages.getString("exf.191"), true)) //$NON-NLS-1$
            ChatCommandHandle.checkForChatDisable = true;
        if (getConfig().getBoolean(Messages.getString("exf.192"), true)) //$NON-NLS-1$
            ChatCommandHandle.checkForIgnores = true;
        if (CH.getBoolean(Messages.getString("exf.193"), true)) //$NON-NLS-1$
            pm.registerEvents(new Whispers(this), this);
        if (CH.getBoolean(Messages.getString("exf.194"), false)) //$NON-NLS-1$
            pm.registerEvents(new Spoilers(this), this);
        Bukkit.getScheduler().scheduleSyncRepeatingTask(this, () -> {
            for (Player p : Bukkit.getOnlinePlayers()) {
                if (AllChat.vlchat.containsKey(p)) {
                    double vladd = AllChat.vlchat.get(p);
                    if (vladd > 0) {
                        vladd = vladd - 1;
                        AllChat.vlchat.put(p, vladd);
                    }
                }
            }
        }, 20L, 120L);
        if (loglvl > 1)
            getServer().getLogger().info(Messages.getString("exf.195")); //$NON-NLS-1$
        if (getConfig().getBoolean(Messages.getString("exf.196")) //$NON-NLS-1$
                && config.getBoolean(Messages.getString("exf.197"))) { //$NON-NLS-1$
            Bukkit.getScheduler().scheduleSyncRepeatingTask(this, Offhand::clearfunc, 20L, (getConfig().getLong(Messages.getString("exf.198")))); //$NON-NLS-1$
        }
        if (loglvl > 1)
            getServer().getLogger().info(Messages.getString("exf.199")); //$NON-NLS-1$
        API.uptime();
        if (loglvl > 1)
            getServer().getLogger().info(Messages.getString("exf.200")); //$NON-NLS-1$
        Bukkit.getScheduler().scheduleSyncRepeatingTask(this, TPS::refresh, 0L, 4L);
        Bukkit.getScheduler().scheduleSyncRepeatingTask(this, () -> {
            Bukkit.getLogger().info(Messages.getString("exf.201")); //$NON-NLS-1$
            duping.clear();
            AllChat.vlchat.clear();
            Join.ef.clear();
            Join.send.clear();
            AllChat.vlchat.clear();
            Bukkit.getLogger().info(Messages.getString("exf.202")); //$NON-NLS-1$
        }, 20L, getConfig().getLong(Messages.getString("exf.203")) * 20); //$NON-NLS-1$
        if (loglvl > 1)
            getServer().getLogger().info(Messages.getString("exf.204")); //$NON-NLS-1$
        RegisterStats.onEnable();
        getServer().getLogger().info(API.getPrefix() + ChatColor.GREEN + Messages.getString("exf.205")); //$NON-NLS-1$
    }

    @EventHandler
    public void onPlayerCommandPreprocess(PlayerCommandPreprocessEvent event) {
        String message = event.getMessage();
        Player player = event.getPlayer();
        if (getConfig().getBoolean(Messages.getString("exf.206"))) { //$NON-NLS-1$
            ChatCommandHandle.docommandLog(message, player.getName());
        }
        if (message.contains(Messages.getString("exf.207")) || message.contains(Messages.getString("exf.208"))) { //$NON-NLS-1$ //$NON-NLS-2$
            event.setCancelled(true);
            player.kickPlayer(API.getPrefix() + Messages.getString("exf.209")); //$NON-NLS-1$
        }
        if (CH.getBoolean(Messages.getString("exf.210"), true)) //$NON-NLS-1$
            ChatCommandHandle.onPlayerCommandPreprocess(event, message, player);
        String label = event.getMessage().toLowerCase();
        if (label.startsWith(Messages.getString("exf.211")) && CH.getBoolean(Messages.getString("exf.212"))) { //$NON-NLS-1$ //$NON-NLS-2$
            CommandHandle.donate(event);
        }
        if (label.startsWith(Messages.getString("exf.213")) && CH.getBoolean(Messages.getString("exf.214"))) { //$NON-NLS-1$ //$NON-NLS-2$
            CommandHandle.discord(event);
        }
    }

}